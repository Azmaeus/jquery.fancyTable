/*!
 * jQuery fancyTable plugin
 * https://github.com/myspace-nu
 *
 * Copyright 2018 Johan Johansson
 * Released under the MIT license
 */
!function(a){a.fn.fancyTable=function(e){var t=a.extend({inputStyle:"",inputPlaceholder:"Search...",pagination:!1,paginationClass:"btn btn-light",paginationClassActive:"active",pagClosest:3,perPage:10,sortable:!0,searchable:!0,onInit:function(){},testing:!1},e),n=this;return this.tableUpdate=function(e){if(e.fancyTable.matches=0,a(e).find("tbody tr").each(function(){var n=0,l=!0,s=!1;a(this).find("td").each(function(){t.globalSearch||!e.fancyTable.searchArr[n]||new RegExp(e.fancyTable.searchArr[n],"i").test(a(this).html())?!t.globalSearch||e.fancyTable.search&&!new RegExp(e.fancyTable.search,"i").test(a(this).html())||(s=!0):l=!1,n++}),t.globalSearch&&s||!t.globalSearch&&l?(e.fancyTable.matches++,e.fancyTable.matches>e.fancyTable.perPage*(e.fancyTable.page-1)&&e.fancyTable.matches<=e.fancyTable.perPage*e.fancyTable.page?a(this).show():a(this).hide()):a(this).hide()}),e.fancyTable.pages=Math.ceil(e.fancyTable.matches/e.fancyTable.perPage),t.pagination){a(e).find(".pag").empty();for(var l=1;l<=e.fancyTable.pages;l++)if(1==l||l>e.fancyTable.page-(t.pagClosest+1)&&l<e.fancyTable.page+(t.pagClosest+1)||l==e.fancyTable.pages){var s=a("<a>",{html:l,"data-n":l,style:"margin:0.2em",class:t.paginationClass+" "+(l==e.fancyTable.page?t.paginationClassActive:"")}).css("cursor","pointer").bind("click",function(){e.fancyTable.page=a(this).data("n"),n.tableUpdate(e)});l==e.fancyTable.pages&&e.fancyTable.page<e.fancyTable.pages-t.pagClosest-1&&a(e).find(".pag").append(a("<span>...</span>")),a(e).find(".pag").append(s),1==l&&e.fancyTable.page>t.pagClosest+2&&a(e).find(".pag").append(a("<span>...</span>"))}}},this.tableSort=function(e){if(void 0!==e.fancyTable.sortColumn&&e.fancyTable.sortColumn<e.fancyTable.nColumns){var t=a(e).find("tbody tr").toArray().sort(function(t,n){var l=a(t).find("td").eq(e.fancyTable.sortColumn).html(),s=a(n).find("td").eq(e.fancyTable.sortColumn).html();return l<s?-e.fancyTable.sortOrder:l>s?e.fancyTable.sortOrder:0});a(e).find("tbody").empty().append(t)}},this.each(function(){if("TABLE"!==a(this).prop("tagName"))return console.warn("fancyTable: Element is not a table."),!0;var e=a(this);if(e.fancyTable={nColumns:a(e).find("td").first().parent().find("td").length,nRows:a(this).find("tbody tr").length,perPage:t.perPage,page:1,pages:0,matches:0,searchArr:[],search:"",sortColumn:t.sortColumn,sortOrder:1},0==a(e).find("tbody").length){var l=a(e).html();a(e).empty(),a(e).append("<tbody>").append(a(l))}if(0==a(e).find("thead").length&&a(e).prepend(a("<thead>")),t.sortable){var s=0;a(e).find("thead th").each(function(){var t=a(this).html(),l=a("<a>",{html:t,"data-n":s,class:""}).css("cursor","pointer").bind("click",function(){e.fancyTable.sortColumn==a(this).data("n")?e.fancyTable.sortOrder=-e.fancyTable.sortOrder:e.fancyTable.sortOrder=1,e.fancyTable.sortColumn=a(this).data("n"),n.tableSort(e),n.tableUpdate(e)});a(this).empty(),a(this).append(l),s++})}if(t.searchable){var i=a("<tr>");if(t.globalSearch){var r=a("<input>",{placeholder:t.inputPlaceholder,style:"width:100%;"+t.inputStyle}).bind("change paste keyup",function(){e.fancyTable.search=a(this).val(),n.tableUpdate(e)}),c=a("<th>",{style:"padding:2px;"}).attr("colspan",e.fancyTable.nColumns);a(r).appendTo(a(c)),a(c).appendTo(a(i))}else{s=0;a(e).find("td").first().parent().find("td").each(function(){e.fancyTable.searchArr.push("");var l=a("<input>",{"data-n":s,placeholder:t.inputPlaceholder,style:"width:100%;"+t.inputStyle}).bind("change paste keyup",function(){e.fancyTable.searchArr[a(this).data("n")]=a(this).val(),n.tableUpdate(e)}),r=a("<th>",{style:"padding:2px;"});a(l).appendTo(a(r)),a(r).appendTo(a(i)),s++})}i.appendTo(a(e).find("thead"))}
// Sort
n.tableSort(e),t.pagination&&(a(e).find("tfoot").remove(),a(e).append(a("<tfoot><tr></tr></tfoot>")),a(e).find("tfoot tr").append(a("<td class='pag'></td>",{}).attr("colspan",e.fancyTable.nColumns))),n.tableUpdate(e)}),this}}(jQuery);